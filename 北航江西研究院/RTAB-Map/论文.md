## 介绍

RTAB-Map是基于图的SLAM方法，自2013年以来已作为rtabmapros7软件包集成在ROS中。图1显示了其主要的ROS节点rtabmap。 里程表是RTAB-Map的外部输入，这意味着SLAM也可以使用任何一种里程表来完成，以使用适合给定应用程序和机器人的功能。 地图的结构是带有节点和链接的图。 传感器同步后，短期内存（STM）模块将创建一个节点，用于存储里程计姿态，传感器的原始数据以及对下一个模块有用的其他信息（例如，用于闭环和邻近检测的可视单词，以及用于全局地图装配的局部占用网格）  。 根据从节点创建的数据相互重叠的多少，以固定的“ Rtabmap / DetectionRate”速率（以毫秒为单位）创建节点。 例如，如果机器人运动迅速且传感器范围较小，则应提高检测率以确保连续节点的数据重叠，但是将其设置得过高则会不必要地增加内存使用量和计算时间。 链接包含两个节点之间的刚性转换。 共有三种链接：邻居链接，闭环链接和邻近链接。 通过里程表转换在相邻节点之间的STM中添加邻居链接。 分别通过闭环检测或接近检测来添加闭环和邻近链接。 所有链接都被用作图优化的约束。 当在图形上添加了新的闭环或邻近链接时，图形优化会将计算出的误差传播到整个图形，以减少里程表漂移。 通过优化图形，可以组装OctoMap，点云和2D占领网格输出，并将其发布到外部模块。 还可以通过ff [Foote，2013] / map→/ odom进行测程法校正以得出机器人在地图框中的位置。

![img](fig_1.png)
##### rtabmapROS节点的框图。 所需的输入是：TF，用于定义传感器相对于机器人基座的位置； 任何来源的里程表（可以是3DoF或6DoF）； 相机输入之一（一个或多个RGB-D图像，或立体声图像）以及相应的校准消息。 可选输入是来自2D激光雷达的激光扫描或来自3D激光雷达的点云。 然后将来自这些输入的所有消息同步并传递给graph-SLAM算法。 输出为：Map Data，其中包含最新添加的带有压缩传感器数据的节点和图形； 没有任何数据的Map Graph； 里程计校正发布在TF上； 可选的OctoMap（3D占用网格）； 可选的密集点云； 可选的2D占用网格。


RTAB-Map的内存管理方法[Labb́e and Michaud，2013]在图形管理模块之上运行。 它用于限制图形的大小，以便可以在大型环境中实现长期在线SLAM。 如果没有内存管理，则随着图形的增长，诸如LoopClosure和接近检测，图形优化和全局地图组装之类的模块的处理时间最终可能会超出实时限制，即处理时间可能变得大于节点采集周期时间。 基本上，RTAB-Map的内存分为工作内存（WM）和长期内存（LTM）。 当节点转移到LTM时，WM内部的模块不再可用。 当RTAB-Map的更新时间超过固定时间阈值“ Rtabmap / TimeThr”时，WM中的某些节点将转移到LTM以限制WM的大小并减少更新时间。 与固定时间阈值相似，还有一个内存阈值“ Rtabmap / MemoryThr”，可用于设置WM可以容纳的最大节点数。 为了确定要转移到LTM的节点，加权机制使用启发式方法（例如，观察到的位置越长，则越重要）来标识比其他位置更重要的位置，因此应将其保留在WM中。 为此，在创建新节点时，STMinitial将节点的权重设置为0，然后将其权重与图形中的最后一个节点进行可视化比较（得出相应的视觉单词的百分比）。 如果它们是相似的（相应的视觉单词的百分比超过相似阈值“ Mem / RehearsalSimilarity”），则新节点的权重加最后一个节点的权重。 最后一个节点的权重重置为0，如果机器人不移动，则最后一个节点将被丢弃，以避免无用地增加图形大小。 当达到时间或内​​存阈值时，最小的加权节点中最早的节点将首先传输到LTM。 当WM中某个位置发生闭环时，可以将该位置的邻居节点从LTM带回到WM，以进行更多的闭环和邻近检测。 当机器人在先前访问的区域中移动时，它可以逐渐记住过去的位置，以扩展当前的组合地图并使用过去的位置进行定位[Labb́e and Michaud，2017]。下一节将更详细地说明RTAB-Map的流程， 从Odometry节点到GlobalMap组装。 提供了用于配置和使用RTAB-Map的关键参数的定义。


## 里程计节点


### 视觉里程计

### 雷达里程计


## 同步